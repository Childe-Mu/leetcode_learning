package com.moon.leetcode.lcp;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

// LCP 46. ÂøóÊÑøËÄÖË∞ÉÈÖç
//„ÄåÂäõÊâ£ÊåëÊàòËµõ„ÄçÊúâ `n` ‰∏™ÊØîËµõÂú∫È¶ÜÔºàÂú∫È¶ÜÁºñÂè∑‰ªé `0` ÂºÄÂßãÔºâÔºåÂú∫È¶Ü‰πãÈó¥ÁöÑÈÄöÈÅìÂàÜÂ∏ÉÊÉÖÂÜµËÆ∞ÂΩï‰∫é‰∫åÁª¥Êï∞ÁªÑ `edges` ‰∏≠Ôºå`edges[i]= [x, y
//]` Ë°®Á§∫Á¨¨ `i` Êù°ÈÄöÈÅìËøûÊé•Âú∫È¶Ü `x` ÂíåÂú∫È¶Ü `y`(Âç≥‰∏§‰∏™Âú∫È¶ÜÁõ∏ÈÇª)„ÄÇÂàùÂßãÊØè‰∏™Âú∫È¶Ü‰∏≠ÈÉΩÊúâ‰∏ÄÂÆö‰∫∫Êï∞ÁöÑÂøóÊÑøËÄÖÔºà‰∏çÂêåÂú∫È¶Ü‰∫∫Êï∞ÂèØËÉΩ‰∏çÂêåÔºâÔºåÂêéÁª≠ `m` Â§©ÊØèÂ§©
//Âùá‰ºöÊ†πÊçÆËµõ‰∫ãÁÉ≠Â∫¶ËøõË°åÂøóÊÑøËÄÖ‰∫∫Êï∞Ë∞ÉÈÖç„ÄÇË∞ÉÈÖçÊñπÊ°àÂàÜ‰∏∫Â¶Ç‰∏ã‰∏âÁßçÔºö
//1. Â∞ÜÁºñÂè∑‰∏∫ `idx` ÁöÑÂú∫È¶ÜÂÜÖÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞ÂáèÂçäÔºõ
//2. Â∞ÜÁºñÂè∑‰∏∫ `idx` ÁöÑÂú∫È¶ÜÁõ∏ÈÇªÁöÑÂú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞ÈÉΩÂä†‰∏äÁºñÂè∑‰∏∫ `idx` ÁöÑÂú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞Ôºõ
//3. Â∞ÜÁºñÂè∑‰∏∫ `idx` ÁöÑÂú∫È¶ÜÁõ∏ÈÇªÁöÑÂú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞ÈÉΩÂáèÂéªÁºñÂè∑‰∏∫ `idx` ÁöÑÂú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞„ÄÇ
//
//ÊâÄÊúâÁöÑË∞ÉÈÖç‰ø°ÊÅØËÆ∞ÂΩï‰∫éÊï∞ÁªÑ `plans` ‰∏≠Ôºå`plans[i] = [num,idx]` Ë°®Á§∫Á¨¨ `i` Â§©ÂØπÁºñÂè∑ `idx` ÁöÑÂú∫È¶ÜÊâßË°å‰∫ÜÁ¨¨ `num`
// ÁßçË∞ÉÈÖçÊñπÊ°à„ÄÇ
//Âú®ÊØîËµõÁªìÊùüÂêéÂØπË∞ÉÈÖçÊñπÊ°àËøõË°åÂ§çÁõòÊó∂Ôºå‰∏çÊÖéÂ∞ÜÁ¨¨ `0` ‰∏™Âú∫È¶ÜÁöÑ**ÊúÄÁªà**ÂøóÊÑøËÄÖ‰∫∫Êï∞‰∏¢Â§±ÔºåÂè™‰øùÁïô‰∫Ü**ÂàùÂßã**ÊâÄÊúâÂú∫È¶ÜÁöÑÂøóÊÑøËÄÖÊÄª‰∫∫Êï∞ `totalNum` Ôºå
//‰ª•ÂèäËÆ∞ÂΩï‰∫ÜÁ¨¨ `1 ~ n-1` ‰∏™Âú∫È¶ÜÁöÑ**ÊúÄÁªà**ÂøóÊÑøËÄÖ‰∫∫Êï∞ÁöÑ‰∏ÄÁª¥Êï∞ÁªÑ `finalCnt`„ÄÇËØ∑‰Ω†Ê†πÊçÆÁé∞ÊúâÁöÑ‰ø°ÊÅØÊ±ÇÂá∫ÂàùÂßãÊØè‰∏™Âú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞ÔºåÂπ∂ÊåâÂú∫È¶ÜÁºñÂè∑È°∫
//Â∫èËøîÂõûÂøóÊÑøËÄÖ‰∫∫Êï∞ÂàóË°®„ÄÇ
//
//**Ê≥®ÊÑèÔºö**
//- ÊµãËØïÊï∞ÊçÆ‰øùËØÅÂΩìÊüêÂú∫È¶ÜËøõË°åÁ¨¨‰∏ÄÁßçË∞ÉÈÖçÊó∂ÔºåËØ•Âú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞‰∏ÄÂÆö‰∏∫ÂÅ∂Êï∞Ôºõ
//- ÊµãËØïÊï∞ÊçÆ‰øùËØÅÂΩìÊüêÂú∫È¶ÜËøõË°åÁ¨¨‰∏âÁßçË∞ÉÈÖçÊó∂ÔºåËØ•Âú∫È¶ÜÁöÑÁõ∏ÈÇªÂú∫È¶ÜÂøóÊÑøËÄÖ‰∫∫Êï∞‰∏ç‰∏∫Ë¥üÊï∞Ôºõ
//- ÊµãËØïÊï∞ÊçÆ‰øùËØÅÊØîËµõÂºÄÂßãÊó∂ÊØè‰∏™Âú∫È¶ÜÁöÑÂøóÊÑøËÄÖ‰∫∫Êï∞ÈÉΩ‰∏çË∂ÖËøá `10^9`Ôºõ
//- ÊµãËØïÊï∞ÊçÆ‰øùËØÅÁªôÂÆöÁöÑÂú∫È¶ÜÈó¥ÁöÑÈÅìË∑ØÂàÜÂ∏ÉÊÉÖÂÜµ‰∏≠‰∏ç‰ºöÂá∫Áé∞Ëá™ÁéØ„ÄÅÈáçËæπÁöÑÊÉÖÂÜµ„ÄÇ
//
//
//**Á§∫‰æã 1Ôºö**
//>![image.png](https://pic.leetcode-cn.com/1630061228-gnZsOz-image.png)
//> ËæìÂÖ•Ôºö
//>`finalCnt = [1,16], totalNum = 21, edges = [[0,1],[1,2]], plans = [[2,1],[1,0
//],[3,0]]`
//>
//> ËæìÂá∫Ôºö`[5,7,9]`
//>
//> Ëß£ÈáäÔºö
//> ![image.png](https://pic.leetcode-cn.com/1630061300-WuVkeF-image.png){:heigh
//t=200}
//
//
//**Á§∫‰æã 2 Ôºö**
//> ËæìÂÖ•Ôºö
//>`finalCnt = [4,13,4,3,8], totalNum = 54, edges = [[0,3],[1,3],[4,3],[2,3],[2,
//5]], plans = [[1,1],[3,3],[2,5],[1,0]]`
//>
//> ËæìÂá∫Ôºö`[10,16,9,4,7,8]`
//
//
//
//**ÊèêÁ§∫Ôºö**
//- `2 <= n <= 5*10^4`
//- `1 <= edges.length <= min((n * (n - 1)) / 2, 5*10^4)`
//- `0 <= edges[i][0], edges[i][1] < n`
//- `1 <= plans.length <= 10`
//- `1 <= plans[i][0] <=3`
//- `0 <= plans[i][1] < n`
//- `finalCnt.length = n-1`
//- `0 <= finalCnt[i] < 10^9`
//- `0 <= totalNum < 5*10^13`
// üëç 0 üëé 0
public class LCP_46_volunteerDeployment {
    public int[] volunteerDeployment(int[] finalCnt, long totalNum, int[][] edges, int[][] plans) {
        HashMap<Integer, List<Integer>> map = new HashMap<>();
        for (int[] edge : edges) {
            map.computeIfAbsent(edge[0], o -> new ArrayList<>()).add(edge[1]);
            map.computeIfAbsent(edge[1], o -> new ArrayList<>()).add(edge[0]);
        }
        int n = finalCnt.length + 1;
        long[][] f = new long[n][2];
        f[0][0] = 1;
        f[0][1] = 0;
        for (int i = 0; i < finalCnt.length; i++) {
            f[i + 1][1] = finalCnt[i];
        }
        for (int i = plans.length - 1; i >= 0; i--) {
            int a = plans[i][0];
            int b = plans[i][1];
            long x = f[b][0];
            long y = f[b][1];
            if (a == 1) {
                f[b][0] = 2 * x;
                f[b][1] = 2 * y;
            } else {
                boolean t = a == 2;
                List<Integer> list = map.getOrDefault(b, new ArrayList<>());
                for (int j : list) {
                    f[j][0] += t ? -x : x;
                    f[j][1] += t ? -y : y;
                }
            }
        }
        long a = 0;
        long b = 0;
        for (long[] ff : f) {
            a += ff[0];
            b += ff[1];
        }
        long x = (totalNum - b) / a;
        int[] ans = new int[n];
        for (int i = 0; i < n; i++) {
            ans[i] = (int) (f[i][0] * x + f[i][1]);
        }
        return ans;
    }

}
